# MOT20 YOLOv26 + SAHI + DeepOCSORT - GPU优化配置
# 充分利用 RTX 4090 24GB 显存

# ========== 检测器配置 ==========
detector:
  model_path: "weights/yolov26x.pt"
  device: "cuda:0"
  conf_thres: 0.25
  iou_thres: 0.45
  max_det: 1000
  img_size: 1920          # 增大到原图分辨率，充分利用显存
  nms_free: true
  half_precision: true    # 强制FP16，节省显存+加速

# ========== ReID配置 ==========
reid:
  model_type: "osnet"        # 使用 OSNet 专门的行人ReID模型
  model_path: "weights/osnet_x1_0_msmt17_combineall_256x128_amsgrad_ep150_stp60_lr0.0015_b64_fb10_softmax_labelsmooth_flip_jitter.pth"
  feature_dim: 512           # OSNet x1.0 输出512维特征  # ✓ 已下载
  device: "cuda:0"
  feature_dim: 128
  batch_size: 64          # 增大ReID批处理
  half_precision: true

# ========== 跟踪器配置 ==========
tracker:
  max_age: 30
  min_hits: 3
  iou_threshold: 0.3
  appearance_threshold: 0.25
  w_iou: 0.3
  w_appearance: 0.5
  w_motion: 0.2
  use_observation_centroid: true

# ========== SAHI配置 (关键优化) ==========
sahi:
  enabled: true
  slice_height: 960       # 增大切片，减少切片数量
  slice_width: 960
  overlap_height_ratio: 0.2
  overlap_width_ratio: 0.2
  batch_size: 16          # 增大批处理！充分利用显存
  merge_iou_threshold: 0.5
  score_fusion: "weighted"
  box_fusion: "weighted_avg"

# ========== 数据配置 ==========
data:
  root: "./data/MOT20"
  yaml_path: "data/MOT20_YOLO/data.yaml"
  format: "MOTChallenge"

# ========== 输出配置 ==========
output:
  project: "runs/track"
  name: "exp"
  save_video: true
  save_vis: false

# ========== 性能配置 ==========
performance:
  num_workers: 8
  pin_memory: true
  prefetch_factor: 2
